<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="www.thymeleaf.org">
<head th:replace="components :: head(${page}, ~{::meta})">
  <meta charset="UTF-8">
</head>
<body>
<div class="page-container">
   <th:block th:replace="components :: header"></th:block>
      <main>
        <div id='user-container'>
            <th:block th:replace="components :: user"></th:block>
            <div id="user-podcasts">
                <h1 class="text-white">Meus podcasts</h1>
                <div id="user-podcasts-list">
                    <a th:each="user_podcast : ${user_podcasts}" th:href="|/adm/podcast/${user_podcast.id}|" class="user-podcast-item">
                        <img th:src="${user_podcast.cover}" alt="">
                    </a>
                </div>
                <button class="btn btn-outline-light w-50 py-3 add-episode-button">Adicionar episódio</button>
            </div>
        </div>
        <div class="registration-form">
            <form action="/add-podcast" method="POST" class="bg-secondary" enctype="multipart/form-data">
                <div class="form-icon">
                    <svg class="logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  preserveAspectRatio="xMidYMid meet" version="1.0" viewBox="0.0 0.0 212.6 212.6" zoomAndPan="magnify"><g id="change1_1"><path class="fil1" d="m106.3 0c58.547 0 106.3 47.751 106.3 106.3 0 58.548-47.752 106.3-106.3 106.3-58.547 0-106.3-47.751-106.3-106.3 0-58.548 47.751-106.3 106.3-106.3zm-2.5166 107.58c3.3679 0 6.4802 1.1232 8.9837 3.0129-2.2797-1.8812-5.0674-3.2017-8.1845-3.7136-9.4172-1.5457-18.359 4.8733-19.906 14.291-0.048134 0.2952-0.0877 0.5911-0.12114 0.8863-8.9753-3.4729-14.652-12.915-13.034-22.765l5.6127-34.191 38.686 4.1758c0.77904 0.083099 1.5216-0.8015 1.6474-1.9682 0.12662-1.1659-0.4109-2.1897-1.19-2.2728l-38.451-4.1494 0.4217-2.5702 38.702 4.1773c0.7798 0.083103 1.5224-0.80151 1.6474-1.9682 0.12663-1.1659-0.41013-2.1888-1.1899-2.2728l-38.467-4.1517 0.6043-3.6801 38.536 4.1587c0.77904 0.083858 1.5217-0.80087 1.6474-1.9676 0.12662-1.1658-0.4109-2.1896-1.1899-2.2734l-38.303-4.1339 0.5756-3.5061 38.852 4.1936c0.77981 0.083099 1.5223-0.80163 1.6474-1.9676 0.1274-1.1666-0.41014-2.1896-1.1892-2.2734l-38.618-4.1672 0.6408-3.8999c4.697-28.613 63.932-20.855 58.921 9.6718l-10.622 64.708c-1.1247 6.8523-5.5288 12.387-11.341 15.264 0.031784-2.1749-0.35103-4.2891-1.082-6.2535 0.46132 1.4369 0.71304 2.9687 0.71304 4.5555 0 6.9557-4.7902 12.825-11.241 14.482v52.912c0 3.2452-2.1562 5.8992-4.7924 5.8992h-6.6365c-2.6362 0-4.7932-2.654-4.7932-5.8992v-59.231c-1.5388-2.3496-2.4367-5.1536-2.4367-8.1628 0-8.2349 6.715-14.95 14.95-14.95h1.3e-4z" fill="inherit" fill-rule="evenodd"/></g><style xmlns="" class="darkreader darkreader--fallback">html, body, body :not(iframe) {
                        background-color: #181a1b !important;
                        border-color: #776e62 !important;
                        color: #e8e6e3 !important;
                        }</style>
                    </svg>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control item" name="name" id="name" placeholder="Nome">
                </div>
                <div class="form-group">
                    <select name="form_categories_id" class="form-control item" id="categories" required>
                        <option value="" disabled hidden selected>Selecione o gênero</option>
                        <th:block th:each="categorie : ${categories}">
                        	<option th:value="${categorie.id}" th:text="${categorie.name}"></option>
                        </th:block>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control item" name="description" id="description" placeholder="Descrição">
                </div>
                <div class="form-group">
                    <input type="file" name="form_cover_file" id="cover-input" hidden accept="image/png, image/jpeg, image/jpg">
                    <button type="button" class="form-control item" id="select-cover">Selecionar capa</button>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-block create-account">BOOM!</button>
                </div>
            </form>
        </div>
      </main>
      <div id="add-episode-container">
        <div class="registration-form add-episode-field">
            <form action="/add-episode" method="POST" class="bg-light" enctype="multipart/form-data">
                <div class="form-icon">
                    <svg class="logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  preserveAspectRatio="xMidYMid meet" version="1.0" viewBox="0.0 0.0 212.6 212.6" zoomAndPan="magnify"><g id="change1_1"><path class="fil1" d="m106.3 0c58.547 0 106.3 47.751 106.3 106.3 0 58.548-47.752 106.3-106.3 106.3-58.547 0-106.3-47.751-106.3-106.3 0-58.548 47.751-106.3 106.3-106.3zm-2.5166 107.58c3.3679 0 6.4802 1.1232 8.9837 3.0129-2.2797-1.8812-5.0674-3.2017-8.1845-3.7136-9.4172-1.5457-18.359 4.8733-19.906 14.291-0.048134 0.2952-0.0877 0.5911-0.12114 0.8863-8.9753-3.4729-14.652-12.915-13.034-22.765l5.6127-34.191 38.686 4.1758c0.77904 0.083099 1.5216-0.8015 1.6474-1.9682 0.12662-1.1659-0.4109-2.1897-1.19-2.2728l-38.451-4.1494 0.4217-2.5702 38.702 4.1773c0.7798 0.083103 1.5224-0.80151 1.6474-1.9682 0.12663-1.1659-0.41013-2.1888-1.1899-2.2728l-38.467-4.1517 0.6043-3.6801 38.536 4.1587c0.77904 0.083858 1.5217-0.80087 1.6474-1.9676 0.12662-1.1658-0.4109-2.1896-1.1899-2.2734l-38.303-4.1339 0.5756-3.5061 38.852 4.1936c0.77981 0.083099 1.5223-0.80163 1.6474-1.9676 0.1274-1.1666-0.41014-2.1896-1.1892-2.2734l-38.618-4.1672 0.6408-3.8999c4.697-28.613 63.932-20.855 58.921 9.6718l-10.622 64.708c-1.1247 6.8523-5.5288 12.387-11.341 15.264 0.031784-2.1749-0.35103-4.2891-1.082-6.2535 0.46132 1.4369 0.71304 2.9687 0.71304 4.5555 0 6.9557-4.7902 12.825-11.241 14.482v52.912c0 3.2452-2.1562 5.8992-4.7924 5.8992h-6.6365c-2.6362 0-4.7932-2.654-4.7932-5.8992v-59.231c-1.5388-2.3496-2.4367-5.1536-2.4367-8.1628 0-8.2349 6.715-14.95 14.95-14.95h1.3e-4z" fill="inherit" fill-rule="evenodd"/></g><style xmlns="" class="darkreader darkreader--fallback">html, body, body :not(iframe) {
                        background-color: #181a1b !important;
                        border-color: #776e62 !important;
                        color: #e8e6e3 !important;
                        }</style>
                    </svg>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control item" name="title" id="title" placeholder="Título do episódio">
                </div>
                <div class="form-group">
                    <select name="form_podcast_id" class="form-control item" id="podcast" required>
                        <option value="" disabled hidden selected>Selecione o podcast</option>
                        <th:block th:each="user_podcast : ${user_podcasts}">
                        	<option th:value="${user_podcast.id}" th:text="${user_podcast.name}"></option>
                        </th:block>
                    </select>
                </div>
                <div class="form-group">
                    <input type="file" name="form_audio_file" id="audio-input" hidden>
                    <input type="number" name="duration" id="duration-input" hidden>
                    <button type="button" class="form-control item" id="select-audio">Selecionar áudio</button>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-block btn-warning create-account submit-episode-button" disabled>BOOM!</button>
                </div>
            </form>
        </div>
      </div>
	</div>
	
	<th:block th:replace="components :: scripts(${page})"></th:block>
    <script>
        $('#select-cover').click(e => {
            $('#cover-input').click()
        })

        // FORM DE EPISÓDIOS
        $('.add-episode-button').click(e => {
            $('#add-episode-container').addClass('active')
        })

        $('.add-episode-field').click(e => {
            $('#add-episode-container').removeClass('active')
        })

        $('.add-episode-field form').click(e => {
            e.stopPropagation()
        })

        $('#select-audio').click(e => {
            $('#audio-input').click()
        })
        
        // MUDAR VALOR DA DURAÇÃO DO ÁUDIO NO FORM
        $("#audio-input").on("change", event => {
            let target = event.currentTarget
            let file = target.files[0];
            
            if(target.files && file && ['audio/ogg', 'audio/mp3', 'audio/wav', 'audio/webm', 'audio/mpeg'].includes(file.type)) {
                let reader = new FileReader()
                let audio = document.createElement("audio")

                reader.onload = reader_event => {
                  audio.src = reader_event.target.result

                  audio.onloadedmetadata = () => {
                      let duration = Math.trunc(audio.duration)

                      $('#duration-input').val(duration)
                      $('.submit-episode-button').removeAttr('disabled')
                  }
                }

                reader.onerror = error => {
                    console.log(error)
                }

                reader.readAsDataURL(file)
            } else {
                alert("Tipo de arquivo não suportado ou arquivo não encontrado.")
                $('.submit-episode-button').attr('disabled', true)
            }
        })
    </script>
  </body>
  </html>